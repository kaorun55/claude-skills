# セキュリティ考慮事項

このesaスキルで実装されているセキュリティ対策について説明します。

## 認証情報の保護

### 環境変数による管理
- アクセストークンは `ESA_ACCESS_TOKEN` 環境変数で管理
- スクリプト内やログにトークンをハードコードしない
- Git履歴にトークンが残らない

### 推奨される設定方法

```bash
# .zshrc または .bashrc に追加（ファイルのパーミッションを600に設定）
export ESA_ACCESS_TOKEN="your-token-here"
export ESA_TEAM_NAME="your-team-name"
```

または、direnvを使用:

```bash
# .envrc（.gitignoreに追加すること）
export ESA_ACCESS_TOKEN="your-token-here"
export ESA_TEAM_NAME="your-team-name"
```

## API呼び出しの安全性

### Bearer認証の使用
- トークンはHTTPヘッダー（`Authorization: Bearer`）で送信
- URLパラメータにトークンを含めない（サーバーログへの漏洩防止）

### 入力値の検証
- 記事番号は数値のみを許可（正規表現でバリデーション）
- インジェクション攻撃を防止

### HTTPSの強制
- esa APIはHTTPSのみ対応
- 通信は暗号化される

## 最小権限の原則

### 読み取り専用
- このスキルは記事の検索・取得のみ
- 記事の作成・更新・削除APIは使用しない
- 誤操作によるデータ損失を防止

### esaトークンの権限設定
esaでトークンを発行する際は、最小限の権限を設定することを推奨:

1. esaの設定画面でPersonal access tokensを開く
2. 「Read」権限のみを付与したトークンを作成
3. 「Write」権限は付与しない

## 出力のサニタイズ

### 機密情報のフィルタリング
- APIレスポンスに含まれるユーザーのメールアドレスは表示しない
- 表示する情報は記事のメタデータと本文のみ

## エラーハンドリング

### 安全なエラー表示
- エラーメッセージにトークンを含めない
- 詳細なスタックトレースを表示しない
- ユーザーに必要な情報のみを表示

## 推奨事項

1. **トークンの定期的なローテーション**: 3-6ヶ月ごとにトークンを更新
2. **監査ログの確認**: esaの監査ログでAPI使用状況を定期的に確認
3. **不要なトークンの削除**: 使用しなくなったトークンは速やかに削除
4. **.gitignoreの設定**: `.envrc`などの認証情報ファイルをGit管理外に

## 既知の制限事項

- esa APIのレートリミット: 75リクエスト/15分
- 大量の記事取得時は注意が必要
